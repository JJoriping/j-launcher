// JJoLoL v3
// JOM for j-launcher

var JOM;!function(){JOM={},JOM.custom=[],JOM.externCache={},JOM.externType={},JOM.externURL=function(a,b){return"/"+a+"/"+b},JOM.attachments={files:[]},JOM.parse=function(a,b,c,d,e,f){function g(a){return a.replace(/'/g,'"')}function h(a){function f(f,g,i){var j=i.length,k=r.list[0];if(h.li=h.done=!0,k){if(j>k.space)r.list.unshift(k={space:j,type:f,data:[]});else if(j<k.space)for(;j<k.space;){var l=r.list.shift();if(!(k=r.list[0])){q+=m(l.type,l.data),r.list.unshift(k={space:j,type:f,data:[]});break}k.data[k.data.length-1]+=m(l.type,l.data)}else if(k.type!=f){var l=r.list.shift(),n=m(l.type,l.data);(k=r.list[0])?k.data[k.data.length-1]+=n:q+=n,r.list.unshift(k={space:j,type:f,data:[]})}}else r.list.unshift(k={space:j,type:f,data:[]});return k.data.push(g=JOM.parse(a.slice(g.length),b,c,d,e,!0)),g}var h={};a[0]?(JOM.custom.forEach(function(b){a=a.replace(b[0],b[1])}),a=a.replace(/^(\s*)(\*|-)\s+/g,function(a,b){return f("ul",a,b)}).replace(/^(\s*)\d+\.\s+/g,function(a,b){return f("ol",a,b)}).replace(/\*\*(.+?)\*\*/g,"<b>$1</b>").replace(/__(.+?)__/g,"<u>$1</u>").replace(/\*(.+?)\*/g,"<i>$1</i>").replace(/_(.+?)_/g,"<i>$1</i>").replace(/^~~~+$/,function(a){return h.pureFlush=!0,"<hr>"}).replace(/~~(.+?)~~/g,"<del>$1</del>").replace(/@\{(.+?)\}/g,"<i class='fa fa-$1'></i>").replace(/(\|&gt;|▶|@|!)?(\$\d+?)?\[(.+?)\]\(([^"]+?)(\s+"(.+?)")?\)/g,function(a,d,e,f,h,i,j){var k=b[h]||(h=g(h));switch(e?(e=e.slice(1),c[e]?e=" style='"+c[e]+"'":q+=n("link style "+e)):e="",d){case"▶":case"|&gt;":return"<iframe src='https://www.youtube.com/embed/"+k+"' title='"+(j||h)+"' frameborder='0' allowfullscreen"+e+">"+f+"</iframe>";case"@":return"<video alt='"+f+"' title='"+(j||h)+"' src='"+k+"'"+e+" controls></video>";case"!":return"<img alt='"+f+"' title='"+(j||h)+"' src='"+k+"'"+e+">";default:return"<a title='"+(j||h)+"' href='#' onclick=\"shell.openExternal(\'"+k+"\');\""+e+">"+f+"</a>"}}).replace(/\$(\d+?)\{(.+?)\}/g,function(a,b,d){return c[b]?"<label style='"+c[b]+"'>"+d+"</label>":n("style "+b)+d}).replace(/```(.+?)```/g,function(a,b){return"<code>"+b.replace(/`/g,"<dot>")+"</code>"}).replace(/(^|[^\\])`(.*?)([^\\])`/g,function(a,b,c,d){return b+"<code>"+c+d+"</code>"}).replace(/^(#{1,6})\s*/,function(b,c){return h.h=c.length,a=a.slice(b.length),""}).replace(/^&gt;\s*/,function(b){return h.bq=h.done=!0,r.bq.push(b=a.slice(b.length)),b}).replace(/^(\$\d+?)?\|(\$\d+?)?\|(.+)\|\|$/,function(a,b,d,e){var f="|"==e[0];return f&&(e=e.slice(1)),e=e.split("||"),h.tr=h.done=!0,b&&(r.tStyle=c[b.slice(1)]||n("style "+b.slice(1))),d&&(d=c[d.slice(1)]||n("style "+d.slice(1))),r.tr.push(e.map(function(a){var b=f?"th":"td",c={"-":1,"|":1,"&":"inherit",$:d||""};return a=a.replace(/^((&lt;(-|\||&|\$)(.+?)&gt;)+)/,function(a,b){return b.replace(/&lt;(-|\||&|\$)(.+?)&gt;/g,function(a,b,d){return c[b]=o[b](c[b],d),""}),""}),"<"+b+" rowspan="+c["|"]+" colspan="+c["-"]+" style='text-align: "+c["&"]+";"+c.$+";'>"+a+"</"+b+">"}).join("")),""})):i(),h.bq||k(),h.li||j(),h.tr||l(),h.h?(i(),q+="<h"+h.h+">"+a+"</h"+h.h+">"):h.done?i():(r.bef+=a+" ",h.pureFlush&&i(!0))}function i(a){var b=r.bef.trim();b&&(q+=a?b:"<p>"+b+"</p>"),r.bef=""}function j(){for(var a,b;r.list[0];){if(a=r.list.shift(),!(b=r.list[0])){q+=m(a.type,a.data);break}b.data[b.data.length-1]+=m(a.type,a.data)}}function k(){r.bq.length&&(q+="<blockquote>"+JOM.parse(r.bq.join("//\n"),b,c,d,e,!0)+"</blockquote>"),r.bq=[]}function l(){r.tr.length&&(q+="<table"+(r.tStyle?" style='"+r.tStyle+"'":"")+"><tr>"+r.tr.join("</tr><tr>")+"</tr></table>"),r.tr=[],delete r.tStyle}function m(a,b){return"<"+a+">"+b.map(function(a){return"<li>"+a+"</li>"}).join("")+"</"+a+">"}function n(a){return"<del class='jom-error'>"+a+"</del>"}var o={"-":function(a,b){return Number(b)},"|":function(a,b){return Number(b)},"&":function(a,b){return{l:"left",c:"center",r:"right"}[b]},$:function(a,b){return a+(c[b]||n("style "+b))}},p={"~":"frame","=":"article"},q="",r={bef:"",bq:[],list:[],tr:[],extern:[]},s=a;return a?(b||(b={}),c||(c={}),d||(d={}),e||(e={}),f||(a=a.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/&amp;/g,"&")),a=a.replace(/\\\\/g,"<escape>").replace(/\{\{\{([\s\S]+?)([^\\])\}\}\}/gm,function(a,b,c){var d=btoa(encodeURI((b+c).replace(/\n/g,"<br>")));return"<span>"+d+"</span>"}).replace(/\[#--(\w+?)(!?)\{\{([\s\S]+?)\}\}\]/gm,function(a,f,g,h){return d[f]=g?JOM.parse(h,b,c,d,e,!0):h,""}).replace(/\[#-(\w+?)\]/g,function(a,b){return d.hasOwnProperty(b)?d[b]:n("box "+b)}).replace(/\[#(.+?)\]/g,function(a,b){var c,d;switch(b[0]){case"x":JOM.externCache={},a="";break;case"~":case"=":d=p[b[0]],b=b.slice(1).replace(/\s/g,"-"),a="<div class='jom-loading jom-"+d+"-"+b+"'>...</div>",c=d+" "+b,r.extern.indexOf(c)==-1&&r.extern.push(c);break;case"*":c=b.slice(2),b=b[1],"d"==b?b="desc":"u"==b&&(b="url"),a=(a=JOM.attachments.files[c])?"<span>"+btoa(encodeURI(a[b]))+"</span>"||n("attach type "+b):n("attach "+c);break;case"#":e[b=b.slice(1)]=!0,a="<a class='jom-tag'>"+b+"</a>";break;default:if("br"==b)return"<br>";if("hr"==b)return"<hr>"}return a}).replace(/\$\$(\d+?)\{(.+?)\}(\n|$)/g,function(a,b,d){return c[b]=g(d.trim()),""}).replace(/\[(.+?)\]:(.+?)(\n|$)/g,function(a,c,d){return b[c]=g(d.trim()),""}).replace(/(&gt;|!)(\[.+?\])?(\d*)\{\{([\s\S]+?)\3\}\}/gm,function(a,f,g,h,i){var j=JOM.parse(i,b,c,d,e,!0);switch(f){case"&gt;":return g||(g=""),"<div class='jom-folder'><p class='jom-folder-title'>"+g.slice(1,g.length-1)+"</p><div class='jom-folder-content'>"+j+"</div></div>";case"!":return j;default:return a}}).replace(/(^|\n)(.+?)\n===+($|\n)/g,"$1# $2$3").replace(/(^|\n)(.+?)\n---+($|\n)/g,"$1## $2$3").replace(/\/\/\n/g,"<br>"),a.split("\n").forEach(h),i(),j(),k(),l(),q=q.replace(/<span>(.*?)<\/span>/g,function(a,b){return decodeURI(atob(b))}).replace(/\\(`|\}\}\})/g,"$1").replace(/<escape>/g,"\\").replace(/<dot>/g,"`").replace(/<nbsp>/g,"&nbsp;"),setTimeout(function(){function a(a){function b(a){c&&c.forEach(a)}var c=document.querySelectorAll(a);return{dom:c,replaceWith:function(a){b(function(b){b.innerHTML=a})},removeClass:function(a){b(function(b){b.className=b.className.replace(new RegExp(a+"s*","g"),"")})}}}r.extern.forEach(function(f){function g(a){var f=JOM.attachments;JOM.attachments=a.attach,s==a.text?i.replaceWith(n("recursive")):i.replaceWith(JOM.parse(a.text,b,c,d,e)),JOM.attachments=f,JOM.onexternload&&JOM.onexternload(i.dom)}var h=f.split(" "),i=a(".jom-"+h[0]+"-"+h[1]),j=JOM.externURL(JOM.externType[h[0]]||h[0],h[1]);JOM.externCache[j]?g(JOM.externCache[j]):$.get(j,g).fail(function(){i.replaceWith(n(f))}).always(function(){i.removeClass("jom-loading")})})},1),JOM.tags=Object.keys(e),q):""}}();